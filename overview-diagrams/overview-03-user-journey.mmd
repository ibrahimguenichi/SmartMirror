graph TB
    User([ğŸ‘¤ User])
    
    subgraph "Step 1: Authentication"
        Login["ğŸ” Login<br/>Email/Password or OAuth2"]
        FaceAuth["ğŸ˜Š Face Recognition<br/>Biometric Auth"]
    end
    
    subgraph "Step 2: Smart Mirror Interface"
        Dashboard["ğŸ“Š Dashboard<br/>Personal View"]
        Modules["ğŸ§© Modules<br/>Weather â€¢ News â€¢ Calendar"]
        Camera["ğŸ“· Camera<br/>Live Face Detection"]
        Chat["ğŸ’¬ AI Assistant<br/>LLM Chat"]
    end
    
    subgraph "Step 3: Backend Processing"
        API["ğŸ”Œ REST API<br/>Spring Boot"]
        AIService["ğŸ¤– AI Service<br/>FastAPI"]
        Business["ğŸ“‹ Business Logic<br/>Reservations â€¢ Users"]
        FaceML["ğŸ¯ Face ML<br/>InsightFace Model"]
        LLMService["ğŸ§  LLM Service<br/>Ollama"]
    end
    
    subgraph "Step 4: Data Storage"
        UserDB[("ğŸ‘¥ Users<br/>PostgreSQL")]
        ReservDB[("ğŸ“… Reservations<br/>PostgreSQL")]
        FaceDB[("ğŸ˜Š Face Data<br/>pgvector<br/>512-dim vectors")]
        KnowledgeDB[("ğŸ“š Knowledge<br/>FabLab Docs")]
    end
    
    subgraph "Step 5: Response"
        Display["âœ¨ Display<br/>Updated UI"]
        Notification["ğŸ“§ Notifications<br/>Email/In-App"]
        QRCode["ğŸ“± QR Code<br/>Access Token"]
    end
    
    User -->|Interacts| Login
    User -->|Scans Face| FaceAuth
    
    Login --> Dashboard
    FaceAuth -->|Extract Embedding| AIService
    
    Dashboard --> Modules
    Dashboard --> Camera
    Dashboard --> Chat
    
    Modules -->|Fetch Data| API
    Camera -->|Send Image| AIService
    Chat -->|Send Message| AIService
    
    API --> Business
    AIService --> FaceML
    AIService --> LLMService
    
    Business --> UserDB
    Business --> ReservDB
    FaceML --> FaceDB
    LLMService --> KnowledgeDB
    
    UserDB -.->|Return Data| API
    ReservDB -.->|Return Data| API
    FaceDB -.->|Match Vector| FaceML
    KnowledgeDB -.->|Context| LLMService
    
    API -.->|Response| Display
    AIService -.->|AI Response| Display
    API -.->|Trigger| Notification
    API -.->|Generate| QRCode
    
    Display -.->|Show| User
    Notification -.->|Notify| User
    QRCode -.->|Scan| User
    
    classDef userClass fill:#FF6B6B,stroke:#C44569,stroke-width:3px,color:#fff
    classDef authClass fill:#4ECDC4,stroke:#1A535C,stroke-width:2px,color:#fff
    classDef uiClass fill:#95E1D3,stroke:#3D5A80,stroke-width:2px,color:#000
    classDef backendClass fill:#F7DC6F,stroke:#D4AC0D,stroke-width:2px,color:#000
    classDef dataClass fill:#BB8FCE,stroke:#7D3C98,stroke-width:2px,color:#fff
    classDef responseClass fill:#85C1E2,stroke:#3498DB,stroke-width:2px,color:#000
    
    class User userClass
    class Login,FaceAuth authClass
    class Dashboard,Modules,Camera,Chat uiClass
    class API,AIService,Business,FaceML,LLMService backendClass
    class UserDB,ReservDB,FaceDB,KnowledgeDB dataClass
    class Display,Notification,QRCode responseClass
